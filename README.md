# Telegram Income & Expense Bot

Асинхронный Telegram-бот для учёта личных доходов и расходов с возможностью генерации красиво оформленного Excel-отчёта на основе шаблона.

---

## Возможности

- Ввод доходов и расходов в Telegram в свободной форме.
- Сохранение всех данных по категориям для каждого пользователя.
- Генерация Excel-отчёта с вашими данными на основе шаблона (цвета, формулы, стили).
- Отправка отчёта пользователю прямо в Telegram.
- Поддержка нескольких пользователей (каждый видит только свои данные).
- Гибкая структура шаблона: можно доработать оформление, добавить формулы, автоитоги и т.д.

---

## Структура проекта

```
income-and-expense-table/
  app/
    bot.py                # Основной код Telegram-бота
    main.py               # Пример ручного запуска генерации отчёта
    my_token.py           # Ваш токен Telegram-бота (НЕ выкладывайте в открытый доступ!)
    xlsx_tools/
      tables.py           # Логика генерации и заполнения Excel-отчёта
    files/
      template.xlsx       # Excel-шаблон с оформлением
      ...                 # Сюда сохраняются отчёты
  README.md
```

---

## Быстрый старт

1. **Установите зависимости:**
   ```bash
   pip install python-telegram-bot openpyxl
   ```

2. **Получите токен у [@BotFather](https://t.me/BotFather) и сохраните его в `app/my_token.py`:**
   ```python
   TOKEN = "ваш_токен_бота"
   ```

3. **Создайте шаблон Excel:**
   - Откройте ваш красиво оформленный файл (например, table_test.xlsx).
   - Сохраните его как `table_test.xlsx` в папку `app/files/`.
   - В шаблоне должны быть заранее оформленные таблицы для доходов (B3:C7) и расходов (B16:C29).

4. **Запустите бота:**
   ```bash
   cd app
   python bot.py
   ```

---

## Как пользоваться ботом

1. **Добавьте бота в Telegram и начните диалог.**
2. **Вводите доходы и расходы в формате:**
   ```
   Доход: Зарплата 50000
   Доход: Дивиденды 3000
   Расход: Продукты 12000
   Расход: Транспорт 2000
   ```
3. **Для получения отчёта отправьте команду:**
   ```
   /doit
   ```
   Бот отправит вам Excel-файл с вашими данными, вставленными в шаблон.

---

## Пример работы

**Пользователь:**
```
Доход: Зарплата 50000
Доход: Дивиденды 3000
Расход: Продукты 12000
/доit
```

**Бот:**
- Отправляет Excel-файл, где ваши доходы и расходы вставлены в красиво оформленные таблицы.

---

## Как работает шаблон

- Все оформление, формулы, цвета, объединения ячеек и автоитоги берутся из файла `template.xlsx`.
- Пользовательские данные аккуратно вставляются в диапазоны:
  - Доходы: B3:C7
  - Расходы: B16:C29
- Если данных больше, чем строк в шаблоне — лишние строки игнорируются.

---

## Советы по доработке

- **Измените шаблон Excel** под свои нужды: добавьте формулы, автоитоги, условное форматирование, графики и т.д.
- **Добавьте обработку других команд** (например, /reset для сброса данных пользователя).
- **Сделайте бота многоязычным** — добавьте поддержку английского, украинского и т.д.
- **Добавьте сохранение истории** — чтобы пользователь мог получить отчёты за разные периоды.

---

## Безопасность

- Никогда не выкладывайте свой токен Telegram-бота (`my_token.py`) в открытый доступ!
- Не храните важные данные пользователей в открытом виде.

---

## Возможные проблемы

- **Ошибка FileNotFoundError:**  
  Убедитесь, что файл `template.xlsx` существует в папке `app/files/`.
- **Ошибка Conflict: terminated by other getUpdates request:**  
  Запущено несколько экземпляров бота. Остановите все лишние процессы и запустите только один.

---

## Лицензия

MIT (или ваша лицензия)

---

## Контакты

Если у вас есть вопросы или предложения — создайте issue или напишите автору проекта.